<div *ngIf="chatRoom; else no_chatroom_selected">
    <div *ngIf="isRoomProtected && !passwordValidated">
        room is protected!!!!
        <mat-card>
            <mat-card-content>
                <form [formGroup]="passwordPrompt" (ngSubmit)="checkPassword()">
                    <mat-form-field>
                        <input type="password" matInput placeholder="Enter password for chatroom" formControlName="passwordValidation">
                        <mat-error *ngIf ="password.touched && password.hasError('required')">Password is required</mat-error>
                    </mat-form-field>

                    <mat-hint *ngIf="!passwordPrompt.valid"><small>Please enter chatroom password</small></mat-hint>
            
                    <div class="button">
                        <button mat-button type="submit" [disabled]="!passwordPrompt.valid">Enter password</button>
                    </div>
                </form>
            </mat-card-content>
        </mat-card>
    </div>
	<div *ngIf="(!isRoomProtected || (isRoomProtected && passwordValidated))">
		<div style="height: 125px;">
			<span style="display: flex; flex-direction: row; align-items: center; justify-content: space-between;">
				<h2>{{chatRoom.name}}</h2>
				<span style="display: flex; flex-direction: row; align-items: center;">
					<mat-icon>event</mat-icon>
					<p style="margin-left: 10px;">
						{{chatRoom.updated_at | date}}
					</p>
				</span>
			</span>
			<span>
				<h3 style="color: grey;">{{chatRoom.description}}</h3>
				<span *ngFor="let user of chatRoom.users">{{user.username}},</span>
			</span>
		</div>
		
		<div *ngIf="isRoomPrivate">
			<button mat-button (click)="togglePasswordForm()">Set password for chat</button>
			<button mat-button (click)="checkSetPassword()">check Password</button>
		</div>
		
		<div *ngIf="showPasswordForm">
			<mat-card>			
				<mat-card-content>
					<form [formGroup]="passwordForm" (ngSubmit)="setChatPassword()">
						<mat-form-field>
							<input type="password" matInput placeholder="Password" formControlName="password">
							<mat-error *ngIf ="password.touched && password.hasError('required')">Password is required</mat-error>
						</mat-form-field>
						
						<mat-form-field>
							<input type="password" matInput placeholder="Password Confirmation" formControlName="passwordConfirm">
							<mat-error *ngIf ="passwordConfirm.touched && passwordForm.hasError('passwordsNotMatching')">Passwords not matching</mat-error>
						</mat-form-field>
						
						<mat-hint *ngIf="!passwordForm.valid"><small>Please set password correctly</small></mat-hint>
						
						<div class="button">
							<button mat-button type="submit" [disabled]="!passwordForm.valid">Set password</button>
						</div>
					</form>
				</mat-card-content>
			</mat-card>
		</div>

		<!-- Messages -->
		<div #messages class="message message-container">
			<span *ngFor="let message of (messagesPaginate$ | async)?.items">
				<app-chat-message [message]="message"></app-chat-message>
			</span>
		</div>

		<!-- Add Message -->
		<div style="position: absolute; bottom: 0; display: flex; flex-direction: row; align-items: center;">
			<mat-form-field style="width: 350px;">
				<input matInput [formControl]="chatMessage" type="text" (keyup.enter)="sendMessage()">
			</mat-form-field>
			<button mat-button [disabled]="!chatMessage.valid || !chatMessage.value" (click)="sendMessage()">
				<span style="display: flex; flex-direction: row; align-items: center;">
					<mat-icon style="margin-left: 20px;">send</mat-icon>
					<p style="margin-left: 10px;">Send</p>
				</span>
			</button>
		</div>
	</div>
</div>
<ng-template #no_chatroom_selected>
	<mat-error>No Chatroom Selected</mat-error>
</ng-template>